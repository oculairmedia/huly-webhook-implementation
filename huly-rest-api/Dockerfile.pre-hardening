FROM huly-huly-mcp:v0.7

USER root

COPY --chown=nodejs:nodejs server.js /app/
COPY --chown=nodejs:nodejs package.json /app/

USER nodejs

ENV NODE_ENV=production
ENV PORT=3458

EXPOSE 3458

HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD node -e "require('http').get('http://localhost:3458/health', (r) => {let d=''; r.on('data', (c) => d+=c); r.on('end', () => {if(JSON.parse(d).status==='ok') process.exit(0); process.exit(1)})})"

CMD ["node", "server.js"]
